**Basic SW**
`cargo install itm
`rustup component add llvm-tools-preview
`sudo apt-get install \`
  `gdb-multiarch \`
  `minicom \`
  `openocd`

**Set udev rules so that the device can be programmed by any user**

Find device id and vendor id:
`lsusb | grep ST-LINK
You should get sth like:
`$ lsusb | grep ST-LINK
Bus 003 Device 003: ID 0483:374b STMicroelectronics ST-LINK/V2.1
0483 is the device id, 374b is vendor id.

Create the file:
/etc/udev/rules.d/99-openocd.rules

And put:
`# STM32F3DISCOVERY - ST-LINK/V2.1
`ATTRS{idVendor}=="0483", ATTRS{idProduct}=="374b", MODE:="0666"
`

Reload rules:
`sudo udevadm control --reload-rules

**Create project**
`cargo generate --git https://github.com/burrbull/stm32-template/`
It will ask for your exact microcontroller info

In my case, for the STM32L452RET6U, it generated the memory.x file and the config file automagically. The memory.x file says where the flash and the ram are in the memory mapping. The config file is inside .cargo and it tells the system which target architecture you have:

**Prepare OpenOCD to connect to the target**
`openocd -f interface/stlink.cfg -f target/stm32l4x.cfg

**.cargo/config.toml**
This is the cargo autogenerated file. Pay attention to the target, that will change depending on the processor.
`[target.'cfg(all(target_arch = "arm", target_os = "none"))']`
`runner = "probe-rs run --chip STM32L452RETx"`

`rustflags = [`
  # `LLD (shipped with the Rust toolchain) is used as the default linker`
  `"-C", "link-arg=-Tlink.x",`
  # `"-C", "link-arg=-Tdefmt.x",`
  # `"-C", "link-arg=-Tstlog.x",`

  # `if you run into problems with LLD switch to the GNU linker by commenting out`
  # `this line`
  # `"-C", "linker=arm-none-eabi-ld",`

  # `if you need to link to pre-compiled C libraries provided by a C toolchain`
  # `use GCC as the linker by commenting out both lines above and then`
  # `uncommenting the three lines below`
  # `"-C", "linker=arm-none-eabi-gcc",`
  # `"-C", "link-arg=-Wl,-Tlink.x",`
  # `"-C", "link-arg=-nostartfiles",`
`]`

`[build]`
`target = "thumbv7em-none-eabihf"`

`[env]`
#`DEFMT_LOG = "info"`

**Build**
`cargo build
This should generate this:
target/thumbv7em-none-eabihf/debug/<project-name>

**Flash it**
`gdb-multiarch -q -ex "target remote :3333" target/thumbv7em-none-eabihf/debug/stmtest2`